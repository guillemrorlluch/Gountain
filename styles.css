/* =========================
   THEME / RESET
========================= */
:root{
  --navbar-height:3.5rem;        /* ~56px */
  --bg:#017C9B;
  --panel:#00BDF1;
  --text:#f8fafc;
  --muted:#ffffff;
  --accent:#22c55e;
  --focus:#3b82f6;
  --border:#017C9B;
  --chip:#94a3b81f;
  --chip-border:#64748b;
  --danger:#b91c1c;
}
*{ box-sizing:border-box; }
html, body{ height:100%; margin:0; }
body{
  background:var(--bg);
  color:var(--text);
  font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* =========================
   TOPBAR (FIJO)
========================= */
.topbar{
  position:fixed; inset:0 0 auto 0;
  height:var(--navbar-height);
  display:flex; align-items:center; gap:.625rem;
  padding:0 .75rem;
  background:#017C9B;
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(.5rem); -webkit-backdrop-filter:blur(.5rem);
  z-index:1000;
}
.topbar h1{ margin:0; font-size:1rem; font-weight:700; letter-spacing:.018rem; }
.hamburger{
  width:2.5rem; height:2.25rem;
  display:inline-flex; align-items:center; justify-content:center;
  border-radius:.625rem; border:1px solid #00BDF1;
  background:#1f2937; color:inherit; cursor:pointer;
}
.hamburger .bars,
.hamburger .bars::before,
.hamburger .bars::after{
  content:""; display:block; width:1.125rem; height:.125rem;
  background:var(--text); position:relative; border-radius:.125rem;
}
.hamburger .bars::before{ position:absolute; top:-.375rem; }
.hamburger .bars::after{  position:absolute; top:.375rem; }

.topbar select{
  margin-left:auto;
  appearance:none;
  background:#1f2937; color:var(--text);
  border:1px solid #017C9B;
  border-radius:.625rem;
  padding:.375rem .625rem;
  min-height:2.25rem;
}
.info-btn{
  margin-left:.375rem;
  min-width:2.25rem; min-height:2.25rem;
  border-radius:.625rem; border:1px solid #017C9B;
  background:#1f2937; color:var(--text); cursor:pointer;
}

/* =========================
   LAYOUT (SIDEBAR + MAP)
========================= */
#layout{
  display:flex; gap:0;
  height:calc(100vh - var(--navbar-height));
  height:calc(100dvh - var(--navbar-height));
  margin-top:var(--navbar-height);
  overflow:hidden;
}

/* Sidebar en flujo */
#layout #sidebar{
  flex:1 0 33.333%;
  display:flex; flex-direction:column;
  overflow:auto;
  background:var(--panel);
  border-right:1px solid var(--border);
  position:static; inset:auto; width:auto; z-index:auto;
}

/* Mapa */
#map-container{
  flex:2 0 66.666%;
  position:relative; min-width:0;
  overflow:hidden;
}
#map{ position:absolute; inset:0; background:#0b1220; pointer-events:auto; }

/* =========================
   RESPONSIVE
========================= */
@media (min-width:769px){
  #layout #sidebar{ flex:1 0 33.333%; }
  #map-container{   flex:2 0 66.666%; }
}
@media (max-width:768px){
  :root{ --navbar-height:3.25rem; }
  #layout #sidebar{ flex:2 0 66.666%; }
  #map-container{   flex:1 0 33.333%; }
}

/* =========================
   SIDEBAR CONTENT
========================= */
.panel-section{ padding:.75rem; }
.panel-section h2{ margin:.5rem 0 .375rem; font-size:.875rem; }
details{
  background:#017C9B; border:1px solid #1f2a44; border-radius:.625rem;
  padding:.5rem .625rem; margin:.625rem 0;
}
summary{ cursor:pointer; color:var(--muted); font-weight:700; list-style:none; }
.chips{ display:flex; flex-wrap:wrap; gap:.5rem; margin-top:.5rem; }

.chip{
  border:1px solid var(--chip-border); border-radius:999px;
  padding:.375rem .75rem;
  color:#fff; background:var(--chip); cursor:pointer; font-size:.8125rem;
  user-select:none; transition:background .2s,color .2s,border-color .2s,transform .05s;
  min-height:2.25rem; min-width:2.75rem;
}
.chip:hover{ background:#94a3b833; }
.chip:active{ transform:translateY(1px); }
.chip.active{ background:#16a34a; color:#fff; border-color:#16a34a; }

.input{
  width:5rem; padding:.375rem; border-radius:.5rem;
  border:1px solid #334155; background:#0000003d; color:#e5e7eb;
}
.altitude-inputs{ display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }

/* =========================
   GLOSSARY PANEL (overlay fijo)
========================= */
#glossary.panel{
  position:fixed; top:var(--navbar-height); bottom:0; right:0;
  width:20rem; background:var(--panel);
  border-left:1px solid var(--border); z-index:1001; overflow:auto;
}
#glossary.panel.hidden{ display:none !important; }

/* Sidebar NO overlay (corrige conflicto) */
#sidebar.panel{ position:static; width:auto; }

/* =========================
   BASEMAP SWITCHER / CHIP BAR
========================= */
.basemap-switcher{
  position:absolute; left:.75rem; top:.75rem;
  display:flex; gap:.375rem; flex-wrap:wrap;
  padding:.5rem;
  background:#111827d0; border:1px solid var(--border); border-radius:.625rem;
  backdrop-filter:blur(.5rem); -webkit-backdrop-filter:blur(.5rem);
  z-index:1002; max-width:calc(100% - 1.5rem);
  pointer-events:auto!important;
}
.basemap-switcher button{
  border:1px solid #00BDF1; border-radius:999px;
  background:#1f2937; color:var(--text);
  padding:.375rem .625rem; font-size:.8125rem; cursor:pointer;
  min-height:2rem; pointer-events:auto;
}
.basemap-switcher button.active{
  border-color:var(--accent);
  box-shadow:0 0 0 1px var(--accent) inset;
}

.destination-chips{
  position:absolute; left:.75rem; right:5.25rem; bottom:.75rem;
  display:flex; flex-wrap:wrap; gap:.375rem; align-items:center;
  z-index:900; padding:.375rem; max-width:calc(100% - 6rem);
  pointer-events:none; box-sizing:border-box;
}
.destination-chips .chip{
  white-space:nowrap; max-width:100%; overflow:hidden; text-overflow:ellipsis;
  pointer-events:auto;
}

.chip-bar{
  position:fixed; left:0; right:0; bottom:0;
  display:flex; gap:.5rem; align-items:center;
  overflow-x:auto; padding:.625rem .75rem;
  background:#111827d0; border-top:1px solid var(--border);
  backdrop-filter:blur(.5rem); -webkit-backdrop-filter:blur(.5rem);
  z-index:1000; pointer-events:none;
}
.chip-bar .chip{ white-space:nowrap; pointer-events:auto; }
.chip-bar::-webkit-scrollbar{ height:.375rem; }
.chip-bar::-webkit-scrollbar-thumb{ background:#475569; border-radius:999px; }

/* =========================
   MAPBOX / POPUPS
========================= */
.mapboxgl-ctrl-top-right{ top:.75rem; right:.75rem; }
.mapboxgl-canvas{ pointer-events:auto; }
.map-health{
  position:absolute; bottom:.625rem; right:.625rem;
  background:#111827d0; color:var(--text);
  padding:.25rem .5rem; border-radius:.375rem; font-size:.75rem; z-index:1000;
}
#map-error{
  position:absolute; top:.75rem; left:50%; transform:translateX(-50%);
  background:var(--danger); color:#fff;
  padding:.375rem .625rem; border-radius:.375rem; z-index:2000; font-size:.875rem;
}

/* Popup tema claro */
.mapboxgl-popup{ max-width:26.25rem; font-family:system-ui,sans-serif; }
.mapboxgl-popup-content{
  background:#F5F5F7; color:#1c1c1c; font-size:.875rem; line-height:1.5;
  padding:1rem; border-radius:.625rem;
  box-shadow:0 .125rem .625rem rgba(0,0,0,.15);
}
.mapboxgl-popup-close-button{ color:#1c1c1c; font-size:1.125rem; top:.5rem; right:.625rem; }
.popup h3{ margin:0 0 .5rem; font-size:1.125rem; line-height:1.3; }
.popup h3 a{ color:#1da1f2; text-decoration:none; border:0; cursor:pointer; }
.popup h3 a:hover{ text-decoration:underline; }

/* =========================
   ACCESSIBILITY
========================= */
.mapboxgl-ctrl button:focus-visible,
button:focus-visible, a:focus-visible, select:focus-visible{
  outline:.125rem solid #7aa2ff; outline-offset:.125rem;
}

/* =========================
   RESPONSIVE TWEAKS
========================= */
@media (max-width:50rem){ .basemap-switcher{ left:.625rem; max-width:calc(100vw - 1.25rem); } }
@media (max-width:37.5rem){ #glossary.panel{ width:66.666vw; max-width:none; } .mapboxgl-popup{ max-width:min(92vw,26.25rem); } }
@media (max-width:26.25rem){ .popup .grid{ grid-template-columns:1fr; } .gallery img{ height:5.625rem; } }

/* =========================
   UTILITIES
========================= */
.hidden{ display:none !important; }

/* =========================
   DEBUG (opcional)
========================= */
/*
#layout #sidebar{ background:rgba(255,0,0,.18)!important; }
#map-container{ background:rgba(0,128,255,.18)!important; }
*/

.basemap-switcher.hidden{display:none!important;}
/* Botón Layers arriba-izquierda */
.layers-btn{
  position:absolute;
  left:.75rem;
  top:.25rem;                   /* botón más arriba */
  display:inline-flex; align-items:center; gap:.5rem;
  padding:.5rem .65rem; border-radius:.625rem;
  background:#111827d0; border:1px solid var(--border);
  color:#fff; font-size:.9rem; cursor:pointer;
  z-index:1003; backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
}
.layers-btn .icon{width:20px;height:20px;display:block;color:#fff;}
.layers-btn:hover{box-shadow:0 0 0 1px #ffffff22 inset;}
@media (max-width:480px){ .layers-btn .label{display:none;} }

/* Switcher debajo del botón (separado) */
.basemap-switcher{
  position:absolute;
  left:.75rem;
  top:3rem;                   /* ⟵ ajusta la separación real */
  display:flex; gap:.375rem; flex-wrap:wrap;
  padding:.5rem; max-width:calc(100% - 1.5rem);
  background:#111827d0; border:1px solid var(--border); border-radius:.625rem;
  backdrop-filter:blur(.5rem); -webkit-backdrop-filter:blur(.5rem);
  z-index:1002; pointer-events:auto!important;
}

/* === Popups compactos en móvil (sin afectar desktop) === */
@media (max-width: 768px) {
  body.is-mobile .mapboxgl-popup { z-index: 9999; }
  body.is-mobile .mapboxgl-popup-content{
    max-width: 78vw;          /* más estrecho */
    max-height: 45vh;         /* más bajo */
    overflow-y: auto;
    padding: 10px 12px;       /* menos padding */
    font-size: 0.92rem;       /* tipografía más pequeña */
    line-height: 1.3;         /* compacto pero legible */
  }
  /* Título del popup y bloques con menos márgenes */
  body.is-mobile .mapboxgl-popup-content h1,
  body.is-mobile .mapboxgl-popup-content h2,
  body.is-mobile .mapboxgl-popup-content h3{
    font-size: 1.05rem;
    margin: 0 0 6px;
  }
  body.is-mobile .mapboxgl-popup-content p,
  body.is-mobile .mapboxgl-popup-content li{
    margin: 0 0 6px;
  }
  /* Flechita del popup un pelín más discreta */
  body.is-mobile .mapboxgl-popup-tip{ transform: scale(.9); }
}

/* === Popups compactos para Tablet (sin afectar desktop) === */
@media (max-width: 820px) and (min-width: 769px){
  body.is-mobile .mapboxgl-popup-content{
    max-width: 70vw;
    max-height: 50vh;
  }
}
