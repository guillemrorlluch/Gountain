<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>It's Gountain Time</title>

  <!-- PWA / Manifest (SIN ?v=) -->
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#00a0c6" />
  <meta name="background-color" content="#ffffff" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="It's Gountain" />

  <!-- Icons (con cache-busting) -->
  <link rel="icon" type="image/png" sizes="192x192" href="/assets/GountainTime-192.png?v=13" />
  <link rel="apple-touch-icon" sizes="512x512" href="/assets/GountainTime-512.png?v=13" />

  <!-- Mapbox GL v2 (compatible con tu código) -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js" defer></script>

  <!-- CSS de la app (con cache-busting) -->
  <link rel="stylesheet" href="/styles.css?v=13" />
</head>
<body>
  <!-- Topbar -->
  <header class="topbar">
    <button id="btnMenu" class="hamburger" aria-label="Abrir filtros">
      <span class="bars"></span>
    </button>
    <h1>It's Gountain</h1>
    <select id="continent-select" aria-label="Filtrar continente">
      <option value="">Todos los continentes</option>
      <option value="América del Norte">América del Norte</option>
      <option value="América del Sur">América del Sur</option>
      <option value="Europa">Europa</option>
      <option value="África">África</option>
      <option value="Asia">Asia</option>
      <option value="Oceanía">Oceanía</option>
      <option value="Antártida">Antártida</option>
    </select>
    <button id="btnInfo" class="info-btn" aria-label="Open glossary">ℹ️</button>
  </header>

  <!-- Basemap switcher (alineado a la izquierda bajo la topbar) -->
  <div id="basemap-switcher" class="basemap-switcher" aria-label="Map style"></div>

  <!-- Paneles -->
  <aside id="sidebar" class="panel hidden" aria-label="Panel de filtros"></aside>
  <aside id="glossary" class="panel hidden" aria-label="Glosario"></aside>

  <!-- Mapa -->
  <div id="map"></div>

  <!-- Barra de chips de destinos -->
  <div id="dest-chips" class="destination-chips" aria-label="Destinations"></div>

  <!-- Health / errores -->
  <div id="map-health" class="map-health" aria-live="polite">Loading map...</div>
  <div id="map-error" class="hidden" role="alert"></div>

  <!-- JS de tu app (con cache-busting) -->
  <script type="module" src="/dist/app.bundle.js?v=13"></script>
  <script type="module" src="/map.js?v=13"></script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw-v13.js?v=13').catch(console.error);
      });
    }
  </script>

  <noscript>Esta app necesita JavaScript para funcionar.</noscript>

  <script>
  // ---- UI wiring: menú (filtros) y glosario ----
  (function () {
    const $ = (sel) => document.querySelector(sel);

    const btnMenu   = $('#btnMenu');
    const btnInfo   = $('#btnInfo');
    const sidebar   = $('#sidebar');
    const glossary  = $('#glossary');
    const select    = $('#continent-select');

    // Contenido mínimo de los paneles (edítalo a tu gusto)
    if (sidebar && !sidebar.innerHTML.trim()) {
      sidebar.innerHTML = `
        <div class="panel-section">
          <h2>Filtros</h2>
          <p>Elige continente arriba a la derecha.</p>
          <p>Puedes añadir aquí más filtros, chips, etc.</p>
          <button class="btn" id="closeSidebar">Cerrar</button>
        </div>`;
    }
    if (glossary && !glossary.innerHTML.trim()) {
      glossary.innerHTML = `
        <div class="panel-section">
          <h2>Glosario</h2>
          <details open>
            <summary>Dificultades</summary>
            <p><strong>F</strong> Fácil, <strong>PD</strong> Poco Difícil, <strong>AD</strong> Algo Difícil, <strong>D</strong> Difícil…</p>
          </details>
          <details>
            <summary>Consejos</summary>
            <p>LNT, prever meteo, equipo adecuado, permisos, etc.</p>
          </details>
          <button class="btn" id="closeGlossary">Cerrar</button>
        </div>`;
    }

    // Toggles
    if (btnMenu && sidebar) {
      btnMenu.addEventListener('click', () => sidebar.classList.toggle('hidden'));
      sidebar.addEventListener('click', (e) => {
        if (e.target.id === 'closeSidebar') sidebar.classList.add('hidden');
      });
    }
    if (btnInfo && glossary) {
      btnInfo.addEventListener('click', () => glossary.classList.toggle('hidden'));
      glossary.addEventListener('click', (e) => {
        if (e.target.id === 'closeGlossary') glossary.classList.add('hidden');
      });
    }

    // (Opcional) cuando cambie el select de continente, emite un evento.
    // map.js puede escuchar este evento si quieres aplicar filtros en vivo.
    if (select) {
      select.addEventListener('change', () => {
        window.__FILTERS__ = window.__FILTERS__ || {};
        window.__FILTERS__.continent = select.value || '';
        window.dispatchEvent(new CustomEvent('gountain:filters-changed', {
          detail: { continent: window.__FILTERS__.continent }
        }));
      });
    }
  })();
</script>

</body>
</html>
